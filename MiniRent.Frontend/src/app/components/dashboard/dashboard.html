<div class="dashboard-container">
  <!-- Admin Dashboard -->
  <div *ngIf="isAdmin">
    <div class="profile-header">
      <h1>Dashboard</h1>
      <div class="user-info" *ngIf="currentUser">
        <p><strong>{{ currentUser.fullName }}</strong></p>
        <p class="user-role">{{ currentUser.role }}</p>
      </div>
    </div>

    <div *ngIf="loading" class="loading-spinner">
      <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="!loading && dashboard" class="dashboard-content">
      <!-- Metrics Grid -->
      <div class="metrics-grid">
        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric">
              <mat-icon>home</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Total Properties</span>
                <span class="metric-value">{{ dashboard.totalProperties }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric">
              <mat-icon>receipt_long</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Active Rentals</span>
                <span class="metric-value">{{ dashboard.activeRentals }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="metric-card">
          <mat-card-content>
            <div class="metric">
              <mat-icon>mail</mat-icon>
              <div class="metric-info">
                <span class="metric-label">New Inquiries (This Month)</span>
                <span class="metric-value">{{ dashboard.newInquiriesThisMonth }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="metric-card highlight">
          <mat-card-content>
            <div class="metric">
              <mat-icon>attach_money</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Total Monthly Rent</span>
                <span class="metric-value">{{ formatPrice(dashboard.totalMonthlyRent) }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Properties by Status -->
      <mat-card class="status-card">
        <mat-card-header>
          <mat-card-title>Properties by Status</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="status-list">
            <div class="status-item" *ngFor="let status of getStatusEntries()">
              <span class="status-name">{{ status.key }}</span>
              <span class="status-count">{{ status.value }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Global Search -->
      <mat-card class="search-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>search</mat-icon>
            Global Search
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Search Properties & Inquiries</mat-label>
              <input matInput formControlName="query" placeholder="Search by address, tenant name, property title...">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
            <button mat-raised-button color="primary" type="submit" [disabled]="!searchForm.get('query')?.value || searching">
              <mat-icon>search</mat-icon>
              Search
            </button>
          </form>

          <div *ngIf="searching" class="loading-spinner-small">
            <mat-spinner diameter="30"></mat-spinner>
          </div>

          <div *ngIf="!searching && searchResults && (searchResults.properties.length > 0 || searchResults.inquiries.length > 0)" class="search-results">
            <div *ngIf="searchResults.properties.length > 0" class="result-section">
              <h3>Properties ({{ searchResults.properties.length }})</h3>
              <div class="results-list">
                <mat-card class="result-card" *ngFor="let result of searchResults.properties" (click)="navigateToSearchResult(result.type, result.id)">
                  <mat-card-content>
                    <div class="result-item">
                      <mat-icon>{{ getTypeIcon(result.type) }}</mat-icon>
                      <div class="result-info">
                        <h4>{{ result.title }}</h4>
                        <p>{{ result.additionalInfo }}</p>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </div>

            <div *ngIf="searchResults.inquiries.length > 0" class="result-section">
              <h3>Inquiries ({{ searchResults.inquiries.length }})</h3>
              <div class="results-list">
                <mat-card class="result-card" *ngFor="let result of searchResults.inquiries" (click)="navigateToSearchResult(result.type, result.id)">
                  <mat-card-content>
                    <div class="result-item">
                      <mat-icon>{{ getTypeIcon(result.type) }}</mat-icon>
                      <div class="result-info">
                        <h4>{{ result.title }}</h4>
                        <p>{{ result.additionalInfo }}</p>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </div>
            </div>
          </div>

          <div *ngIf="!searching && searchResults && searchResults.properties.length === 0 && searchResults.inquiries.length === 0 && searchForm.get('query')?.value" class="no-results">
            <mat-icon>search_off</mat-icon>
            <p>No results found</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- User Profile -->
  <div *ngIf="!isAdmin">
    <div class="profile-header">
      <h1>User Profile</h1>
      <div class="user-info" *ngIf="currentUser">
        <p><strong>{{ currentUser.fullName }}</strong></p>
        <p class="user-role">{{ currentUser.role }}</p>
      </div>
    </div>

    <div *ngIf="loading" class="loading-spinner">
      <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="!loading" class="profile-content">
    <!-- Rental History Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>receipt_long</mat-icon>
          Rental History
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="section-actions">
          <button mat-button routerLink="/rentals">View All</button>
        </div>
        <div class="rentals-list" *ngIf="allRentals.length > 0; else noRentals">
          <mat-card class="rental-card" *ngFor="let rental of allRentals" [routerLink]="['/rentals', rental.id]">
            <mat-card-content>
              <div class="rental-header">
                <h3>{{ rental.propertyTitle }}</h3>
                <mat-chip [color]="rental.isActive ? 'primary' : 'warn'">
                  {{ rental.isActive ? 'Active' : 'Ended' }}
                </mat-chip>
              </div>
              <p class="rental-location">{{ rental.propertyLocation }}</p>
              <div class="rental-details">
                <div class="detail-item">
                  <mat-icon>person</mat-icon>
                  <span>{{ rental.tenantName }}</span>
                </div>
                <div class="detail-item">
                  <mat-icon>calendar_today</mat-icon>
                  <span>Started: {{ formatDate(rental.startDate) }}</span>
                </div>
                <div class="detail-item" *ngIf="rental.endDate">
                  <mat-icon>event_busy</mat-icon>
                  <span>Ended: {{ formatDate(rental.endDate) }}</span>
                </div>
                <div class="detail-item">
                  <mat-icon>attach_money</mat-icon>
                  <span>{{ formatPrice(rental.monthlyRent) }}/month</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
        <ng-template #noRentals>
          <p class="empty-state">No rental history.</p>
        </ng-template>
      </mat-card-content>
    </mat-card>

    <!-- Converted Inquiries History Section -->
    <mat-card class="section-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>mail</mat-icon>
          Converted Inquiries History
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="section-actions">
          <button mat-button routerLink="/inquiries">View All</button>
        </div>
        <div class="inquiries-list" *ngIf="allInquiries.length > 0; else noInquiries">
          <mat-card class="inquiry-card" *ngFor="let inquiry of allInquiries" [routerLink]="['/inquiries', inquiry.id]">
            <mat-card-content>
              <div class="inquiry-header">
                <h3>{{ inquiry.name }}</h3>
                <mat-chip [color]="getStatusColor(inquiry.status)">{{ inquiry.status }}</mat-chip>
              </div>
              <p class="inquiry-email">{{ inquiry.email }}</p>
              <p class="inquiry-phone">{{ inquiry.phone }}</p>
              <div class="inquiry-property" *ngIf="inquiry.propertyTitle">
                <mat-icon>home</mat-icon>
                <span>{{ inquiry.propertyTitle }} - {{ inquiry.propertyLocation }}</span>
              </div>
              <div class="inquiry-link" *ngIf="inquiry.rentalId">
                <mat-icon>receipt_long</mat-icon>
                <span>Converted to Rental #{{ inquiry.rentalId }}</span>
              </div>
              <p class="inquiry-message" *ngIf="inquiry.message">{{ inquiry.message }}</p>
              <p class="inquiry-date">Created: {{ formatDate(inquiry.createdAt) }}</p>
            </mat-card-content>
          </mat-card>
        </div>
        <ng-template #noInquiries>
          <p class="empty-state">No converted inquiries history.</p>
        </ng-template>
      </mat-card-content>
    </mat-card>
    </div>
  </div>
</div>
